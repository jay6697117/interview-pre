<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="app"></div>
    <script>
      // 1.0
      // function Foo(name, weight) {
      //   this.name = name;
      //   this.weight = weight;
      //   this.showName = function () {
      //     alert(`你好, ${this.name}`);
      //   };
      //   // return '111'; //基础数据类型，返回 new 创建的新对象实例
      //   // return 1; //基础数据类型，返回 new 创建的新对象实例
      //   // return true; //基础数据类型，返回 new 创建的新对象实例
      //   // return undefined; //基础数据类型，返回 new 创建的新对象实例
      //   // return null; //基础数据类型，返回 new 创建的新对象实例
      //   // return {}; //如果函数返回一个对象，那么new 这个函数调用返回这个函数的返回对象
      //   // return []; //如果函数返回一个对象，那么new 这个函数调用返回这个函数的返回对象
      //   // return () => {}; //如果函数返回一个对象，那么new 这个函数调用返回这个函数的返回对象
      // }
      // const f1 = new Foo('zjh', '200');
      // console.log('f1 :>> ', f1);

      // 2.0
      // let obj = {};
      // obj[Symbol('a')] = 'local symbol a'; // 局部 symbol a
      // obj[Symbol.for('b')] = 'global symbol b'; // 全局 symbol b

      // console.log('obj :>> ', obj);
      // console.log('Object.getOwnPropertySymbols(obj) :>> ', Object.getOwnPropertySymbols(obj));

      // for (const iterator of Object.getOwnPropertySymbols(obj)) {
      //   console.log('iterator :>> ', iterator);
      // }

      //3.0
      // demo01
      // function foo() {
      //   var a = 20;
      //   var b = 30;

      //   function bar() {
      //     return a + b;
      //   }

      //   return bar;
      // }

      // console.log('foo :>> ', foo);
      // var bar = foo();
      // console.log('bar :>> ', bar);
      // var res = bar();
      // console.log('res :>> ', res);

      // for (let index = 0; index < array.length; index++) {
      //   const element = array[index];
      // }


      // 4.0 在不刷新页面的情况下改变URL

      new Promise(resolve => {
        setTimeout(() => {
          setBrowserUrl({ name: 'zjh', age: 33, sex: 'man', height: '177 cm' });
          console.log('location.search :>> ', location.search);
          return resolve(location.search);
        }, 2000);
      })
        .then(queryString => {
          console.log('queryString :>> ', queryString);

          const result = getParams(queryString);
          console.log('result :>> ', result);

          for (const key in result) {
            if (Object.hasOwnProperty.call(result, key)) {
              const h1 = document.createElement('h1');
              h1.innerHTML = `${key} : ${result[key]}`;
              document.getElementById('app').appendChild(h1);
            }
          }
        })
        .catch(err => alert(err));

      /**
       * 设置浏览器url
       *  params：queryObj（参数对象）
       */
      function setBrowserUrl(queryObj) {
        // stringify是queryString的一个api，具体可以查看node官网，也可以自己实现
        let url = `${location.pathname}?${parseParams(queryObj)}`;
        // history.pushState({ url: url }, '', url);
        history.replaceState({ url: url }, '', url);
      }

      function parseParams(data) {
        try {
          let tempArr = [];
          for (const i in data) {
            let key = encodeURIComponent(i);
            let value = encodeURIComponent(data[i]);
            tempArr.push(key + '=' + value);
          }
          let urlParamsStr = tempArr.join('&');
          return urlParamsStr;
        } catch (err) {
          alert(err);
          return '';
        }
      }

      function getParams(url) {
        try {
          let index = url.indexOf('?');
          url = url.match(/\?([^#]+)/)[1];
          let obj = {},
            arr = url.split('&');
          for (let i = 0; i < arr.length; i++) {
            let subArr = arr[i].split('=');
            let key = decodeURIComponent(subArr[0]);
            let value = decodeURIComponent(subArr[1]);
            obj[key] = value;
          }
          return obj;
        } catch (err) {
          return null;
        }
      }
    </script>
  </body>
</html>
